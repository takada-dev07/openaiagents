Metadata-Version: 2.4
Name: openaiagents
Version: 0.1.0
Summary: Python + DevContainer LLM Agent learning sandbox (FastAPI, PPTX, workflow DAG)
Author: You
License: MIT
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: fastapi<1.0,>=0.110
Requires-Dist: uvicorn[standard]<1.0,>=0.27
Requires-Dist: pydantic<3.0,>=2.6
Requires-Dist: python-pptx<1.0,>=0.6.23
Requires-Dist: Pillow<12.0,>=10.2
Requires-Dist: httpx<1.0,>=0.27
Requires-Dist: python-dotenv<2.0,>=1.0
Requires-Dist: networkx<4.0,>=3.2
Requires-Dist: rich<14.0,>=13.7
Provides-Extra: dev
Requires-Dist: pytest<9.0,>=8.0; extra == "dev"
Requires-Dist: ruff<0.9,>=0.6; extra == "dev"
Requires-Dist: mypy<2.0,>=1.8; extra == "dev"
Requires-Dist: pre-commit<5.0,>=3.6; extra == "dev"
Requires-Dist: types-Pillow>=10.2.0.20240520; extra == "dev"

# openaiagents（Python + venv で学ぶ LLM Agent 最小環境）

このリポジトリは、Python 仮想環境（venv）で以下を **ローカル実行しながら学ぶ** ための最小構成です。

- LLM Agent基礎（tool calling / 多段処理 / 失敗時の扱い）
- 画像生成（API呼び出しの雛形。実APIは環境変数で差し替え）
- PowerPoint（PPTX）生成（テンプレ差し込み＋画像貼り付け）
- PPTXの解説（pptxから構造抽出＋pptx→画像化して説明できる土台）
- ワークフロー（DAG）設定・実行（JSON定義、実行ログ保存）

実APIキーは不要です（未設定なら **ダミー動作** で最後まで通ります）。

## 前提条件

- Python 3.11 以上

  ```bash
  python3 --version  # 3.11 以上を確認
  ```

- Homebrew（macOS の場合。PPTX→画像化を使う場合のみ必要）

## 初回セットアップ

### 1. システム依存のインストール（オプション）

PPTX→画像化機能を使う場合のみ必要です：

```bash
brew install libreoffice poppler
```

> NOTE: これらのツールが無くても、PPTX生成やその他の機能は動作します。`POST /pptx/explain` で画像化が失敗する場合は警告として返されます。

### 2. 仮想環境の作成と依存インストール

```bash
make setup
```

これにより以下が実行されます：

- `venv/` ディレクトリに仮想環境を作成
- `pip install -e ".[dev]"` でパッケージと開発依存をインストール

### 3. 環境変数の設定

```bash
cp .env.example .env
```

`.env` を編集してください（`OPENAI_API_KEY` は空でもOK。空の場合は画像生成がダミー画像になります）。

> NOTE: この環境では `.env.example` がエディタ上でフィルタされる場合があります。  
> その場合でもファイル自体は存在しているので、手元では `ls -la` 等で確認できます。

## 起動方法（Makefile）

仮想環境をアクティベートしてから実行してください：

```bash
source venv/bin/activate
```

Dev server 起動:

```bash
make dev
```

テスト:

```bash
make test
```

Lint / format / typecheck:

```bash
make lint
make format
make typecheck
```

> NOTE: `make` コマンドは仮想環境内の Python を自動的に使用します（`venv/bin/` 配下の実行ファイルを参照）。仮想環境をアクティベートしていなくても `make dev` 等は動作しますが、開発中の場合は `source venv/bin/activate` してから作業することを推奨します。

## curl での動作確認

### health

```bash
curl -sS http://localhost:8000/health
```

### 画像生成（APIキー無しならダミー画像）

```bash
curl -sS -X POST http://localhost:8000/images/generate \
  -H 'Content-Type: application/json' \
  -d '{"prompt":"日本語のテスト画像","size":"512x512","transparent":false}'
```

### PPTX生成

```bash
curl -sS -X POST http://localhost:8000/pptx/render \
  -H 'Content-Type: application/json' \
  -d '{
    "title":"デモ資料",
    "slides":[
      {"heading":"概要","bullets":["最小構成です","あとで拡張できます"]},
      {"heading":"次にやること","bullets":["LLM接続を追加","ツールを増やす"]}
    ]
  }'
```

### PPTX解説（構造抽出＋画像化の土台）

```bash
curl -sS -X POST http://localhost:8000/pptx/explain \
  -H 'Content-Type: application/json' \
  -d '{"pptx_path":"artifacts/deck-<trace_id>.pptx"}'
```

### Agent（疑似tool calling）

```bash
curl -sS -X POST http://localhost:8000/agent/run \
  -H 'Content-Type: application/json' \
  -d '{"task":"PowerPoint資料を作って説明して","context":{"title":"学習用"}}'
```

### Workflow（DAG JSON）

例（README用の最小DAG）：

```json
{
  "nodes": [
    {"id":"outline","tool":"outline","params":{"task":{"$ref":"input.task"}},"retry":0,"timeout_sec":10},
    {"id":"image","tool":"generate_image","params":{"prompt":{"$ref":"input.task"},"size":"512x512","transparent":false},"retry":1,"timeout_sec":60},
    {"id":"pptx","tool":"render_pptx","params":{"title":{"$ref":"results.outline.title"},"slides":{"$ref":"results.outline.slides"},"image_path":{"$ref":"results.image.image_path"}},"retry":0,"timeout_sec":60},
    {"id":"explain","tool":"explain_pptx","params":{"pptx_path":{"$ref":"results.pptx.pptx_path"}},"retry":0,"timeout_sec":60}
  ],
  "edges": [
    {"from":"outline","to":"image"},
    {"from":"image","to":"pptx"},
    {"from":"pptx","to":"explain"}
  ]
}
```

実行:

```bash
curl -sS -X POST http://localhost:8000/workflow/run \
  -H 'Content-Type: application/json' \
  -d '{"workflow":{...},"input":{"task":"ワークフローで資料を作り説明して"}}'
```

## 生成物（artifacts）

- `artifacts/traces/<trace_id>.json`: Agentの実行トレース
- `artifacts/images/<trace_id>/image.png`: 生成画像（ダミー含む）
- `artifacts/deck-<trace_id>.pptx`: 生成PPTX
- `artifacts/slides/<trace_id>/slide-001.png`: PPTX→PNG（環境依存）
- `artifacts/workflows/<trace_id>.json`: Workflow実行ログ

## 典型エラーと対処

### PPTX→画像変換が失敗する

- `soffice`（LibreOffice）や `pdftoppm`（poppler）が無いと失敗します。
  - macOS では `brew install libreoffice poppler` でインストールしてください。
- インストール後も失敗する場合は `POST /pptx/explain` の `warnings` を確認してください。
- これらのツールが無くても、PPTX生成やその他の機能は正常に動作します。

### 日本語が豆腐（□）になる

- macOS では通常、日本語フォントはインストール済みです。
- それでも出る場合はフォント名やPillowのフォント探索が原因のことがあります（ダミー画像の文字）。

### `make setup` が失敗する

- Python 3.11 以上がインストールされているか確認してください。
- `python3 --version` でバージョンを確認できます。
